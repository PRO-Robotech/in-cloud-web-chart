# --- Dependency ----------------------------------------------------------------
incloud-web-resources:
  enabled: false
  addons:
    argocd:
      enabled: false
    hbf:
      enabled: false
    trivy:
      enabled: false

oauth2-proxy:
  enabled: false
  priorityClassName: system-cluster-critical
  config:
    # OAuth Client ID and Client Secret issued by the identity provider (e.g., Dex, Keycloak, Google)
    clientID: "clientid"
    clientSecret: "clientsecret"
    # Secret used to encrypt cookies. Must be a cryptographically strong value
    # Create a new secret with the following command
    # openssl rand -base64 32 | head -c 32 | base64
    cookieSecret: "Vy81NjF6ckxNeE5IVnFuMjFwbEl4dW9YUy8wQ2tUWVQ="

  extraArgs:
    # Authentication provider type (e.g., oidc, google, github)
    provider: oidc

    # Display name shown on the login page for the provider
    provider-display-name: Dex

    # The backend application to proxy to after authentication
    # Replace SVC and PORT with your internal Kubernetes service and port
    upstream: "http://incloud-web-incloud-web-chart"

    # Callback URL where the identity provider redirects after login
    # Must match the redirect URI configured in your IDP
    redirect-url: "http://incloud-web-incloud-web-chart/oauth2/callback"

    # Root URL of the OIDC identity provider (issuer)
    # Should point to your IDP (e.g., Dex, Keycloak, Auth0)
    oidc-issuer-url: "http://incloud-web-incloud-web-chart/dex"

    # Restrict login to specific email domains. Use "*" to allow all domains
    # Example: "example.com" only allows users with @example.com
    email-domain: "*"

    # Forward the OAuth access token to the upstream application
    # Passed in the 'X-Forwarded-Access-Token' header
    pass-access-token: true

    # Forward the Authorization header (e.g., Bearer token) to the upstream
    # Useful if the backend application validates the token itself
    pass-authorization-header: true

    # How often to refresh the session cookie and revalidate the user
    # Helps maintain active sessions without forcing re-login
    cookie-refresh: 1h

    # Name of the cookie used to store the authentication session
    # Should be unique if multiple apps use the same domain
    cookie-name: incloud

    # Set the Secure flag on cookies — only send over HTTPS
    # Should be true in production environments
    cookie-secure: false

    # Skip SSL/TLS certificate verification when connecting to the upstream provider or OIDC issuer
    # WARNING: This disables security checks for HTTPS connections and accepts any certificate, including invalid or self-signed ones
    # Only use in trusted development or testing environments — NEVER in production
    # Default: false (recommended for secure deployments)
    ssl-insecure-skip-verify: true

    # Scopes requested from the identity provider
    # Customize if you need specific claims (e.g., groups)
    scope: "openid email profile groups offline_access"

    # Skip showing the provider login button; redirect directly to IDP
    # Enables seamless single sign-on experience
    skip-provider-button: true

    # OIDC prompt parameter. 'none' avoids login screen if session exists
    # Enables silent authentication when possible
    prompt: none

    # URL prefix for oauth2-proxy endpoints (e.g., /oauth2/callback, /oauth2/sign_in)
    proxy-prefix: /oauth2

    # tls-cert-file: /etc/ssl/tls/tls.crt
    # tls-key-file: /etc/ssl/tls/tls.key

  extraVolumes: []
    # - name: internal-cert
    #   secret:
    #     defaultMode: 420
    #     secretName: incloud-web-cert-internal-tls

  extraVolumeMounts: []
    # - mountPath: /etc/ssl/tls
    #   name: internal-cert

  httpScheme: http
  service:
    portNumber: 4080

dex:
  enabled: false

  config:
    issuer: http://incloud-web-incloud-web-chart/dex

    frontend:
      issuerUrl: http://incloud-web-incloud-web-chart/dex
      theme: "coreos"
      issuer: "InCloud"

    storage:
      type: kubernetes
      config:
        inCluster: true

    # web:
    #   tlsCert: /etc/dex/tls/tls.crt
    #   tlsKey: /etc/dex/tls/tls.key

    expiry:
      signingKeys: "6h"
      idTokens: "24h"

    logger:
      level: debug
      format: json

    oauth2:
      passwordConnector: local

    enablePasswordDB: True

    staticClients:
      - id: "clientid"
        name: "clientid"
        secret: "clientsecret"
        redirectURIs:
          - "http://incloud-web-incloud-web-chart/oauth2/callback"

    # u: admin@example.com
    # p: admin
    staticPasswords:
      - email: "admin@example.com"
        # bcrypt hash of the string "admin": $(echo admin | htpasswd -BinC 10 admin | cut -d: -f2)
        hash: "$2y$10$OFnA7tTUKalTsIiIWzPSp.XE4MhyGSoYh8pzUYSBsuJnN2pcuM7wG"
        username: "admin"
        userID: "08a8684b-db88-4b73-90a9-3cd1661f5466"
  # https:
  #   enabled: true

  service:
    ports:
      http:
        port: 5556
      https:
        port: 5554

  volumes: []
    # - name: internal-cert
    #   secret:
    #     defaultMode: 420
    #     secretName: incloud-web-cert-internal-tls

  volumeMounts: []
    # - mountPath: /etc/dex/tls
    #   name: internal-cert

# --- Cluster ---------------------------------------------------------------
clusters:
  - name: default
    description: default
    tenant: dev
    scheme: http
    api: 127.0.0.1

# --- Global ----------------------------------------------------------------
nameOverride: ""                  # Overrides chart name; leave empty to use default
fullnameOverride: "" # Overrides full release name; leave empty to use default

# Number of pod replicas
replicaCount: 1

# Pull secrets for private registries
imagePullSecrets: []               # e.g. [{ name: regcred }]

# Priority class for the pod
priorityClassName: system-cluster-critical

# --- ServiceAccount --------------------------------------------------------
serviceAccount:
  create: true
  name: ""                         # Defaults to <release>-<chart>
  annotations: {}

# --- Pod-level settings ----------------------------------------------------
podAnnotations: {}
podLabels: {}
podSecurityContext:
  enabled: true
  fsGroup: 101
  fsGroupChangePolicy: "OnRootMismatch"

# Node placement settings
nodeSelector: {}
tolerations: []
topologySpreadConstraints: []

# Networking-related pod spec
dnsPolicy: ClusterFirst
hostNetwork: false
hostPID: false
hostIPC: false
schedulerName: default-scheduler
runtimeClassName: ""
enableServiceLinks: false
preemptionPolicy: ""

# Volumes (user-defined; appended with nginx config if enabled)
volumes: []

# --- Service ---------------------------------------------------------------
service:
  enabled: true
  type: ClusterIP
  annotations: {}
  labels: {}
  ports:
    - name: web-http
      port: 8080
      targetPort: 8080
      protocol: TCP
    - name: nginx-http
      port: 80
      targetPort: 8081
      protocol: TCP
    - name: bff-http
      port: 8082
      targetPort: 8082
      protocol: TCP

externalDomain: incloud-web-incloud-web-chart
externalDomainPort: 80

expose:
  enabled: false
  # resourceType: allowed values [istio, ingress]
  resourceType: ingress

  ingress:
    annotations: {}
    labels: {}
    ingressClassName: ""

  istio:
    gateway:
      enabled: true
      name: incloud-istio-gateway
      istioLabelsSelector: {} # required value!
        # istio: istio-ingressgateway
      annotations: {}
      labels: {}
    virtualService:
      annotations: {}
      labels: {}

  path: /
  # servicePort
  # set incloud-web port
  servicePort: 80
  tls:
    # The source of the tls certificate. Set as "certmanager", "secret"
    # or "none" and fill the information in the corresponding section
    # 1) certmanager: generate the tls certificate automatically over CertManager
    # 2) secret: read the tls certificate from the specified secret.
    # The tls certificate can be generated manually or by cert manager
    # 3) none: configure no tls certificate for the ingress. If the default
    # tls certificate is configured in the ingress controller, choose this option
    certSource: none
    certmanager:
      # existingIssuer
      # if you want to use an existing issuer, you must specify:
      # kind (Issuer or ClusterIssuer) and name
      existingIssuer:
        kind: Issuer
        name: ""
    secret:
      # The name of secret which contains keys named:
      # "tls.crt" - the certificate
      # "tls.key" - the private key
      secretName: ""

# The internal TLS used for in-cloud components secure communicating. In order to enable https
# in each component tls cert files need to provided in advance.
internalTLS:
  # There are three ways to provide tls
  # 1) "certmanager" will generate cert automatically
  # 2) "secret" internal certificates from secret
  # 3) "none" no certificates
  certSource: none
  certmanager:
    # existingIssuer
    # if you want to use an existing issuer, you must specify:
    # kind (Issuer or ClusterIssuer) and name
    existingIssuer:
      kind: Issuer
      name: ""
  secret:
    # Each name of secret must contain keys named:
    # "tls.crt" - the certificate
    # "tls.key" - the private key

    # oauth2-proxy related cert configuration
    oauth2-proxy:
      # secret name for oauth2-proxy's tls certs
      secretName: ""
    # dex related cert configuration
    dex:
      # secret name for dex's tls certs
      secretName: ""

# --- Container: bff --------------------------------------------------------
bff:
  # Main toggle for enabling or disabling the BFF (Backend For Frontend) service
  enabled: true

  # Basic identification settings for the BFF container
  name: bff

  # Container image configuration
  image:
    repository: prorobotech/openapi-ui-k8s-bff
    tag: release-1.0.2-9a5e636a
    pullPolicy: IfNotPresent

  # Networking configuration for the container
  containerPort: 8082
  extraContainerPorts: []

  # Environment variables that configure BFF behavior and integration with Kubernetes API
  env:
    BASE_API_GROUP: "front.in-cloud.io"
    BASE_API_VERSION: "v1alpha1"
    DEBUG_CONTAINER_IMAGE: "nicolaka/netshoot:v0.13"
    LOGGER: "TRUE"
    LOGGER_WITH_HEADERS: "TRUE"
    PORT: "8082"
    KUBE_API_URL: "https://kubernetes.default.svc"
  envFrom: []

  # Resource requests and limits for CPU, memory and ephemeral storage
  resources:
    limits:
      cpu: "1"
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 128Mi
      ephemeral-storage: 50Mi

  # Security context for the container runtime
  securityContext:
    enabled: true
    allowPrivilegeEscalation: false
    capabilities:
      add:
        - CAP_CHOWN
        - CAP_NET_BIND_SERVICE
        - CAP_SETGID
        - CAP_SETUID
      drop:
        - ALL
    privileged: false
    readOnlyRootFilesystem: false
    runAsGroup: 0
    runAsNonRoot: true
    runAsUser: 101

  # Liveness probe to monitor container health
  livenessProbe:
    enabled: true
    httpGet:
      path: /healthcheck
      port: 8082
      scheme: HTTP
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

  # Readiness probe to control traffic routing only when ready
  readinessProbe:
    enabled: false
    httpGet:
      path: /ready
      port: 8082
      scheme: HTTP
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

  # Additional volumes that can be mounted into the container
  volumeMounts: []

  # Termination message configuration
  terminationMessagePath: /dev/termination-log
  terminationMessagePolicy: File


# --- Container: web --------------------------------------------------------
web:
  # Main toggle for enabling or disabling the web component
  enabled: true

  # Basic identification settings for the web container
  name: web

  # Container image configuration
  image:
    repository: prorobotech/openapi-ui
    tag: release-1.0.2-b06f0da8
    pullPolicy: IfNotPresent

  # Networking configuration for the container
  containerPort: 8080
  extraContainerPorts: []

  # Environment variables that configure integration with APIs and UI behavior
  env:
    BASEPREFIX: "/openapi-ui"
    CUSTOMIZATION_API_GROUP: "front.in-cloud.io"
    CUSTOMIZATION_API_VERSION: "v1alpha1"
    CUSTOMIZATION_NAVIGATION_RESOURCE: "navigation"
    CUSTOMIZATION_NAVIGATION_RESOURCE_NAME: "navigations"
    INSTANCES_API_GROUP: "in-cloud.io"
    INSTANCES_RESOURCE_NAME: "instances"
    INSTANCES_VERSION: "v1alpha1"
    LOGIN_URL: "/oauth2/userinfo"
    LOGIN_USERNAME_FIELD: "email"
    LOGOUT_URL: "/oauth2/sign_out"
    MARKETPLACE_GROUP: "front.in-cloud.io"
    MARKETPLACE_KIND: "MarketplacePanel"
    MARKETPLACE_RESOURCE_NAME: "marketplacepanels"
    MARKETPLACE_VERSION: "v1alpha1"
    NAVIGATE_FROM_CLUSTERLIST: "/openapi-ui/~recordValue~/builtin-table/pods"
    NODE_TERMINAL_DEFAULT_PROFILE: "general"
    PROJECTS_API_GROUP: "in-cloud.io"
    PROJECTS_RESOURCE_NAME: "projects"
    PROJECTS_VERSION: "v1alpha1"
    USE_NAMESPACE_NAV: true
    REMOVE_BACKLINK: true
    REMOVE_BACKLINK_TEXT: true
    DOCS_URL: https://in-cloud.io/docs/tech-docs/introduction/
    SEARCH_TABLE_CUSTOMIZATION_PREFIX: "stock-"
  envFrom: []

  # Resource requests and limits for CPU, memory and ephemeral storage
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
      ephemeral-storage: 50Mi

  # Security context for the container runtime
  securityContext:
    enabled: true
    allowPrivilegeEscalation: false
    capabilities:
      add: 
        - CAP_CHOWN
        - CAP_NET_BIND_SERVICE
        - CAP_SETGID
        - CAP_SETUID
      drop: 
        - ALL
    privileged: false
    readOnlyRootFilesystem: false
    runAsGroup: 0
    runAsNonRoot: true
    runAsUser: 101

  # Liveness probe to monitor container health
  livenessProbe:
    enabled: true
    httpGet:
      path: /healthcheck
      port: 8080
      scheme: HTTP
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

  # Readiness probe to control traffic routing only when ready
  readinessProbe:
    enabled: false
    httpGet:
      path: /ready
      port: 8080
      scheme: HTTP
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

  # Additional volumes that can be mounted into the container
  volumeMounts: []

  # Termination message configuration
  terminationMessagePath: /dev/termination-log
  terminationMessagePolicy: File


# --- Container: nginx (reverse proxy) --------------------------------------
nginx:
  # Main toggle for enabling or disabling the NGINX sidecar
  enabled: true

  # Basic identification settings for the NGINX container
  name: nginx

  # Container image configuration
  image:
    repository: nginxinc/nginx-unprivileged
    tag: "1.29-alpine"
    pullPolicy: IfNotPresent

  # Networking configuration for the container
  containerPort: 8081
  extraContainerPorts: []

  # ConfigMap reference for custom NGINX configuration
  configMapName: ""        # Defaults to "<fullname>-nginx-config"
  configKey: "nginx-config"

  # Environment variables and external sources
  env: {}
  envFrom: []

  # Resource requests and limits for CPU, memory and ephemeral storage
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi
      ephemeral-storage: 50Mi

  # Security context for the container runtime
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    privileged: false
    readOnlyRootFilesystem: false
    runAsGroup: 0
    runAsNonRoot: true
    runAsUser: 101
    seccompProfile:
      type: RuntimeDefault

  # Liveness probe to monitor container health
  livenessProbe:
    enabled: true
    httpGet:
      path: /healthcheck
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

  # Readiness probe to control traffic routing only when ready
  readinessProbe:
    enabled: false
    httpGet:
      path: /ready
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 2
    successThreshold: 1
    failureThreshold: 3

  # Additional volumes that can be mounted into the container
  extraVolumeMounts: []

  # Termination message configuration
  terminationMessagePath: /dev/termination-log
  terminationMessagePolicy: File


# --- Labels/Selectors ------------------------------------------------------
selectorLabels:
  app.kubernetes.io/name: web

# --- Extra customizations --------------------------------------------------
extraPodSpec: {}
extraTemplateMetadata:
  annotations: {}
  labels: {}

extraObjects: []
